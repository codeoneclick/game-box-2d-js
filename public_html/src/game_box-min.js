var gb={REVISION:"1"};"function"===typeof define&&define.amd?define("gb",gb):"undefined"!==typeof exports&&"undefined"!==typeof module&&(module.exports=gb);function ces_base_component(){this.m_type="undefined"}ces_base_component.prototype.get_type=function(){return this.m_type};var g_string_to_glenum=null;gb.configuration_base=function(){this.m_attributes=[];this.m_configurations=[]};
gb.configuration_base.string_to_glenum=function(){null===g_string_to_glenum&&(g_string_to_glenum=[],g_string_to_glenum.GL_FRONT=gl.FRONT,g_string_to_glenum.GL_BACK=gl.BACK,g_string_to_glenum.GL_SRC_COLOR=gl.SRC_ALPHA,g_string_to_glenum.GL_SRC_ALPHA=gl.SRC_ALPHA,g_string_to_glenum.GL_ONE=gl.ONE,g_string_to_glenum.GL_ZERO=gl.ZERO,g_string_to_glenum.GL_ONE_MINUS_SRC_COLOR=gl.ONE_MINUS_SRC_COLOR,g_string_to_glenum.GL_ONE_MINUS_DST_COLOR=gl.ONE_MINUS_DST_COLOR,g_string_to_glenum.GL_ONE_MINUS_SRC_ALPHA=
gl.ONE_MINUS_SRC_ALPHA,g_string_to_glenum.GL_ONE_MINUS_DST_ALPHA=gl.ONE_MINUS_DST_ALPHA,g_string_to_glenum.GL_DST_ALPHA=gl.DST_ALPHA,g_string_to_glenum.GL_CONSTANT_ALPHA=gl.CONSTANT_ALPHA,g_string_to_glenum.GL_REPEAT=gl.REPEAT,g_string_to_glenum.GL_CLAMP_TO_EDGE=gl.CLAMP_TO_EDGE,g_string_to_glenum.GL_MIRRORED_REPEAT=gl.MIRRORED_REPEAT,g_string_to_glenum.GL_NEAREST=gl.NEAREST,g_string_to_glenum.GL_LINEAR=gl.LINEAR,g_string_to_glenum.GL_MIPMAP=gl.LINEAR_MIPMAP_NEAREST,g_string_to_glenum.GL_ALWAYS=gl.ALWAYS,
g_string_to_glenum.GL_EQUAL=gl.EQUAL,g_string_to_glenum.GL_NOTEQUAL=gl.NOTEQUAL,g_string_to_glenum.GL_FUNC_ADD=gl.FUNC_ADD);return g_string_to_glenum};
gb.configuration_base.prototype={constructor:gb.configuration_base,clone:function(){return new this.constructor},copy:function(a){this.m_attributes=a.m_attributes;this.m_configurations=a.m_configurations;return this},set_attribute:function(a,b){this.m_attributes[a]=b;return this},set_configuration:function(a,b,c){this.m_configurations[a]instanceof Object?3===arguments.length?0<=c&&c<this.m_configurations[a].length?this.m_configurations[a][c]=b:this.m_configurations[a].push(b):this.m_configurations[a].push(b):
(this.m_configurations[a]=[],this.m_configurations[a].push(b));return this}};$.getScript("src/configurations/configuration_base.js");gb.game_object_configuration=function(){gb.configuration_base.call(this);Object.defineProperty(this,"materials_configurations",{get:function(){return this.m_configurations instanceof Object&&this.m_configurations.materials instanceof Object?this.m_configurations.materials:null}})};gb.game_object_configuration.prototype=Object.create(gb.configuration_base.prototype);gb.game_object_configuration.prototype.constructor=gb.game_object_configuration;$.getScript("src/configurations/configuration_base.js");$.getScript("src/configurations/shader_configuration.js");$.getScript("src/configurations/texture_configuration.js");
gb.material_configuration=function(){gb.configuration_base.call(this);this.json=null;Object.defineProperty(this,"technique_name",{get:function(){return this.json.technique_name}});Object.defineProperty(this,"technique_pass",{get:function(){return this.json.technique_pass}});Object.defineProperty(this,"is_depth_test",{get:function(){return!!this.json.is_depth_test}});Object.defineProperty(this,"is_depth_mask",{get:function(){return!!this.json.is_depth_mask}});Object.defineProperty(this,"is_cull_face",
{get:function(){return!!this.json.is_cull_face}});Object.defineProperty(this,"cull_face_mode",{get:function(){return gb.configuration_base.string_to_glenum()[this.json.cull_face_mode]}});Object.defineProperty(this,"is_blending",{get:function(){return!!this.json.is_blending}});Object.defineProperty(this,"blending_function_source",{get:function(){return gb.configuration_base.string_to_glenum()[this.json.blending_function_source]}});Object.defineProperty(this,"blending_function_destination",{get:function(){return gb.configuration_base.string_to_glenum()[this.json.blending_function_destination]}});
Object.defineProperty(this,"blending_equation",{get:function(){return gb.configuration_base.string_to_glenum()[this.json.blending_equation]}});Object.defineProperty(this,"is_stencil_test",{get:function(){return!!this.json.is_stencil_test}});Object.defineProperty(this,"stencil_function",{get:function(){return gb.configuration_base.string_to_glenum()[this.json.stencil_function]}});Object.defineProperty(this,"stencil_function_parameter_1",{get:function(){return this.json.stencil_function_parameter_1}});
Object.defineProperty(this,"stencil_function_parameter_2",{get:function(){return this.json.stencil_function_parameter_2}});Object.defineProperty(this,"stencil_mask_parameter",{get:function(){return this.json.stencil_mask_parameter}});Object.defineProperty(this,"shader_configuration",{get:function(){return this.m_configurations instanceof Object&&this.m_configurations.shader instanceof Object&&0<this.m_configurations.shader.length?this.m_configurations.shader[0]:null}});Object.defineProperty(this,
"textures_configurations",{get:function(){return this.m_configurations instanceof Object&&this.m_configurations.textures instanceof Object?this.m_configurations.textures:null}})};gb.material_configuration.prototype=Object.create(gb.configuration_base.prototype);gb.material_configuration.prototype.constructor=gb.material_configuration;
gb.material_configuration.prototype.serialize=function(a){var b=this;$.ajax({dataType:"json",url:a,data:{},async:!1,success:function(a){b.json=a;a=new gb.shader_configuration;a.serialize(b.json.shader);b.set_configuration("shader",a);for(var d=0;d<b.json.textures.length;++d)a=new gb.texture_configuration,a.serialize(b.json.textures[d]),b.set_configuration("textures",a)}})};$.getScript("src/configurations/configuration_base.js");gb.shader_configuration=function(){gb.configuration_base.call(this);this.json=null;Object.defineProperty(this,"filename",{get:function(){return this.json.filename}})};gb.shader_configuration.prototype=Object.create(gb.configuration_base.prototype);gb.shader_configuration.prototype.constructor=gb.shader_configuration;gb.shader_configuration.prototype.serialize=function(a){this.json=a};$.getScript("src/configurations/configuration_base.js");
gb.texture_configuration=function(){gb.configuration_base.call(this);this.json=null;Object.defineProperty(this,"filename",{get:function(){return this.json.filename}});Object.defineProperty(this,"technique_name",{get:function(){return this.json.technique_name}});Object.defineProperty(this,"sampler_index",{get:function(){return this.json.sampler_index}});Object.defineProperty(this,"wrap_mode",{get:function(){return gb.configuration_base.string_to_glenum()[this.json.wrap_mode]}});Object.defineProperty(this,
"mag_filter",{get:function(){return gb.configuration_base.string_to_glenum()[this.json.mag_filter]}});Object.defineProperty(this,"min_filter",{get:function(){return gb.configuration_base.string_to_glenum()[this.json.min_filter]}})};gb.texture_configuration.prototype=Object.create(gb.configuration_base.prototype);gb.texture_configuration.prototype.constructor=gb.texture_configuration;gb.texture_configuration.prototype.serialize=function(a){this.json=a};var game_loop=function(a){function b(){d.attach_to_runloop()(b)}function c(){d={attach_to_runloop:function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1E3/60)}}};return{instance:d,attach_to_runloop:d.attach_to_runloop}}var d=null;return{get_instance:function(){d||(d=c().instance,b());return d}}}(window);gb.mesh_constructor=function(){};
gb.mesh_constructor.create_screen_quad=function(){var a=new gb.vbo(4,gl.STATIC_DRAW),b=a.lock();b[0].position=new gb.vec2(-1,-1);b[0].texcoord=new gb.vec2(0,0);b[1].position=new gb.vec2(-1,1);b[1].texcoord=new gb.vec2(0,1);b[2].position=new gb.vec2(1,-1);b[2].texcoord=new gb.vec2(1,0);b[3].position=new gb.vec2(1,1);b[3].texcoord=new gb.vec2(1,1);a.unlock();var b=new gb.ibo(6,gl.STATIC_DRAW),c=b.lock();c[0]=0;c[1]=1;c[2]=2;c[3]=1;c[4]=2;c[5]=3;b.unlock();return new gb.mesh(a,b,gl.TRIANGLES)};
gb.mesh_constructor.create_sprite_quad=function(){return null};gb.mat4=function(){this.m_elements=[[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]]};
gb.mat4.multiply=function(a,b){var c=a.m_elements,d=b.m_elements,e=new gb.mat4,f=c[0],g=c[4],h=c[8],k=c[12],l=c[1],m=c[5],n=c[9],p=c[13],q=c[2],r=c[6],t=c[10],u=c[14],v=c[3],w=c[7],x=c[11],c=c[15],y=d[0],z=d[4],A=d[8],B=d[12],C=d[1],D=d[5],E=d[9],F=d[13],G=d[2],H=d[6],I=d[10],J=d[14],K=d[3],L=d[7],M=d[11],d=d[15];e.m_elements[0]=f*y+g*C+h*G+k*K;e.m_elements[4]=f*z+g*D+h*H+k*L;e.m_elements[8]=f*A+g*E+h*I+k*M;e.m_elements[12]=f*B+g*F+h*J+k*d;e.m_elements[1]=l*y+m*C+n*G+p*K;e.m_elements[5]=l*z+m*D+n*
H+p*L;e.m_elements[9]=l*A+m*E+n*I+p*M;e.m_elements[13]=l*B+m*F+n*J+p*d;e.m_elements[2]=q*y+r*C+t*G+u*K;e.m_elements[6]=q*z+r*D+t*H+u*L;e.m_elements[10]=q*A+r*E+t*I+u*M;e.m_elements[14]=q*B+r*F+t*J+u*d;e.m_elements[3]=v*y+w*C+x*G+c*K;e.m_elements[7]=v*z+w*D+x*H+c*L;e.m_elements[11]=v*A+w*E+x*I+c*M;e.m_elements[15]=v*B+w*F+x*J+c*d;return e};
gb.mat4.prototype={constructor:gb.mat4,identity:function(){this.m_elements[0]=1;this.m_elements[4]=0;this.m_elements[8]=0;this.m_elements[12]=0;this.m_elements[1]=0;this.m_elements[5]=1;this.m_elements[9]=0;this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=1;this.m_elements[14]=0;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},rotate:function(a){var b=a.x,c=a.y,d=a.z;a=Math.cos(b);var b=Math.sin(b),e=Math.cos(c),
c=Math.sin(c),f=Math.cos(d),d=Math.sin(d),g=a*f,h=a*d,k=b*f,l=b*d;this.m_elements[0]=e*f;this.m_elements[4]=-e*d;this.m_elements[8]=c;this.m_elements[1]=h+k*c;this.m_elements[5]=g-l*c;this.m_elements[9]=-b*e;this.m_elements[2]=l-g*c;this.m_elements[6]=k+h*c;this.m_elements[10]=a*e;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[12]=0;this.m_elements[13]=0;this.m_elements[14]=0;this.m_elements[15]=1;return this},translate:function(a,b,c){this.m_elements[0]=1;this.m_elements[4]=
0;this.m_elements[8]=0;this.m_elements[12]=0;this.m_elements[1]=0;this.m_elements[5]=1;this.m_elements[9]=0;this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=1;this.m_elements[14]=0;this.m_elements[3]=a;this.m_elements[7]=b;this.m_elements[11]=c;this.m_elements[15]=1;return this},rotation_x:function(a){var b=Math.cos(a);a=Math.sin(a);this.m_elements[0]=1;this.m_elements[4]=0;this.m_elements[8]=0;this.m_elements[12]=0;this.m_elements[1]=0;this.m_elements[5]=b;this.m_elements[9]=
-a;this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=a;this.m_elements[10]=b;this.m_elements[14]=0;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},rotate_y:function(a){var b=Math.cos(a);a=Math.sin(a);this.m_elements[0]=b;this.m_elements[4]=0;this.m_elements[8]=a;this.m_elements[12]=0;this.m_elements[1]=0;this.m_elements[5]=1;this.m_elements[9]=0;this.m_elements[13]=0;this.m_elements[2]=-a;this.m_elements[6]=0;this.m_elements[10]=b;this.m_elements[14]=
0;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},rotate_z:function(a){var b=Math.cos(a);a=Math.sin(a);this.m_elements[0]=b;this.m_elements[4]=-a;this.m_elements[8]=0;this.m_elements[12]=0;this.m_elements[1]=a;this.m_elements[5]=b;this.m_elements[9]=0;this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=1;this.m_elements[14]=0;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},
scale:function(a,b,c){this.m_elements[0]=a;this.m_elements[4]=0;this.m_elements[8]=0;this.m_elements[12]=0;this.m_elements[1]=0;this.m_elements[5]=b;this.m_elements[9]=0;this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=c;this.m_elements[14]=0;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},frustum:function(a,b,c,d,e,f){this.m_elements[0]=2*e/(b-a);this.m_elements[4]=0;this.m_elements[8]=(b+a)/(b-a);this.m_elements[12]=
0;this.m_elements[1]=0;this.m_elements[5]=2*e/(d-c);this.m_elements[9]=(d+c)/(d-c);this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=-(f+e)/(f-e);this.m_elements[14]=-2*f*e/(f-e);this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=-1;this.m_elements[15]=0;return this},perspective:function(a,b,c,d){a=c*Math.tan(gb.math.radians(.5*a));var e=-a;return this.frustum(e*b,a*b,e,a,c,d)},ortho:function(a,b,c,d,e,f){var g=1/(b-a),h=1/(c-d),k=1/(f-e);this.m_elements[0]=
2*g;this.m_elements[4]=0;this.m_elements[8]=0;this.m_elements[12]=-((b+a)*g);this.m_elements[1]=0;this.m_elements[5]=2*h;this.m_elements[9]=0;this.m_elements[13]=-((c+d)*h);this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=-2*k;this.m_elements[14]=-((f+e)*k);this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},look_at:function(a,b,c){var d=new gb.vec3,e=new gb.vec3,f=new gb.vec3,f=gb.vec3.sub(a,b).normalize();0===f.length_sq()&&(f.z=1);d=gb.vec3.cross(c,
f).normalize();0===d.length_sq()&&(f.x+=1E-4,d=gb.vec3.cross(c,f).normalize());e=gb.vec3.cross(f,d);this.m_elements[0]=d.x;this.m_elements[4]=e.x;this.m_elements[8]=f.x;this.m_elements[1]=d.y;this.m_elements[5]=e.y;this.m_elements[9]=f.y;this.m_elements[2]=d.z;this.m_elements[6]=e.z;this.m_elements[10]=f.z;return this},equals:function(a){for(var b=0;16>b;b++)if(this.m_elements[b]!==a.m_elements[b])return!1;return!0},to_array:function(){return this.m_elements}};var INT16_MAX=32767,INT16_MIN=-32768;gb.math=function(){};gb.math.radians=function(a){return Math.PI/180*a};gb.math.degrees=function(a){return 180/Math.PI*a};gb.vec2=function(){arguments[0]instanceof gb.vec2?(this.m_x=arguments[0].x,this.m_y=arguments[0].y):1===arguments.length?(this.m_x=arguments[0],this.m_y=arguments[0]):2===arguments.length?(this.m_x=arguments[0],this.m_y=arguments[1]):this.m_y=this.m_x=0;Object.defineProperty(this,"x",{get:function(){return this.m_x},set:function(a){this.m_x=a}});Object.defineProperty(this,"y",{get:function(){return this.m_y},set:function(a){this.m_y=a}})};gb.vec2.add=function(a,b){return new gb.vec2(a.x+b.x,a.y+b.y)};
gb.vec2.sub=function(a,b){return new gb.vec2(a.x-b.x,a.y-b.y)};gb.vec2.lerp=function(a,b,c){return gb.vec2.sub(b,a).multiply_scalar(c).add(a)};gb.vec2.equals=function(a,b){return a.x===b.x&&a.y===b.y};gb.vec2.min=function(a,b){var c=new gb.vec2(0);c.x=Math.min(a.x,b.x);c.y=Math.min(a.y,b.y);return c};gb.vec2.max=function(a,b){var c=new gb.vec2(0);c.x=Math.max(a.x,b.x);c.y=Math.max(a.y,b.y);return c};
gb.vec2.prototype={constructor:gb.vec2,add:function(a){this.x+=a.x;this.y+=a.y;return this},add_scalar:function(a){this.x+=a;this.y+=a;return this},sub:function(a){this.x-=a.x;this.y-=a.y;return this},sub_scalar:function(a){this.x-=a;this.y-=a;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiply_scalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divide_scalar:function(a){this.x/=a;this.y/=a;return this},clamp:function(a,
b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},dot:function(a){return this.x*a.x+this.y*a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divide_scalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distance_to:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},
equals:function(a){return a.x===this.x&&a.y===this.y},to_array:function(){var a=[];a[0]=this.x;a[1]=this.y;return a}};gb.vec3=function(){"gb.vec3"===typeof arguments[0]?(this.m_x=arguments[0].x,this.m_y=arguments[0].y,this.m_z=arguments[0].z):1===arguments.length?(this.m_x=arguments[0],this.m_y=arguments[0],this.m_z=arguments[0]):3===arguments.length?(this.m_x=arguments[0],this.m_y=arguments[1],this.m_z=arguments[2]):this.m_z=this.m_y=this.m_x=0;Object.defineProperty(this,"x",{get:function(){return this.m_x},set:function(a){this.m_x=a}});Object.defineProperty(this,"y",{get:function(){return this.m_y},set:function(a){this.m_y=
a}});Object.defineProperty(this,"z",{get:function(){return this.m_z},set:function(a){this.m_z=a}})};gb.vec3.add=function(a,b){return new gb.vec3(a.x+b.x,a.y+b.y,a.z+b.z)};gb.vec3.sub=function(a,b){return new gb.vec3(a.x-b.x,a.y-b.y,a.z-b.z)};gb.vec3.cross=function(a,b){return new gb.vec3(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x)};
gb.vec3.prototype={constructor:gb.vec3,add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},add_scalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},sub_scalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiply_scalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},
divide_scalar:function(a){this.x/=a;this.y/=a;this.z/=a;return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*
a.z},cross:function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},length_sq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divide_scalar(this.length())},distance_to:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return Math.sqrt(b*b+c*c+a*a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=
(a.z-this.z)*b;return this},lerp_vectors:function(a,b,c){this.sub_vectors(b,a).multiply_scalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},to_array:function(){var a=[];a[0]=this.x;a[1]=this.y;a[2]=this.z;return a}};gb.vec4=function(){"gb.vec4"===typeof arguments[0]?(this.x=arguments[0].get_x(),this.y=arguments[0].get_y(),this.z=arguments[0].get_z(),this.w=arguments[0].get_w()):1===arguments.length?(this.x=arguments[0],this.y=arguments[0],this.z=arguments[0],this.w=arguments[0]):4===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2],this.w=arguments[3]):this.w=this.z=this.y=this.x=0};
gb.vec4.prototype={constructor:gb.vec4,clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},set_x:function(a){this.x=a;return this},set_y:function(a){this.y=a;return this},set_z:function(a){this.z=a;return this},set_w:function(a){this.w=a;return this},get_x:function(){return this.x},get_y:function(){return this.y},get_z:function(){return this.z},get_w:function(){return this.w},add:function(a){this.x+=a.x;
this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},add_scalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},add_vectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},sub_scalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},sub_vectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiply:function(a){this.x*=
a.x;this.y*=a.y;this.z*=a.z;this.w*=a.w;return this},multiply_scalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;this.w/=a.w;return this},divide_scalar:function(a){this.x/=a;this.y/=a;this.z/=a;this.w/=a;return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,
a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){return this.divide_scalar(this.length())},lerp:function(a,
b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerp_vectors:function(a,b,c){this.sub_vectors(b,a).multiply_scalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},to_array:function(){var a=[];a[0]=this.x;a[1]=this.y;a[2]=this.z;a[3]=this.w;return a}};var g_graphics_context=null,graphics_context=function(){return{get_instance:function(){if(!g_graphics_context){var a=document.getElementById("gl_canvas");try{g_graphics_context=a.getContext("experimental-webgl"),g_graphics_context.viewportWidth=a.width,g_graphics_context.viewportHeight=a.height,console.log("OpenGL context created"),console.log("viewport: [ "+a.width+", "+a.height+" ]")}catch(b){}g_graphics_context?(g_graphics_context.clearColor(0,0,0,1),g_graphics_context.enable(g_graphics_context.DEPTH_TEST),
g_graphics_context.viewport(0,0,g_graphics_context.viewportWidth,g_graphics_context.viewportHeight),g_graphics_context.clear(g_graphics_context.COLOR_BUFFER_BIT|g_graphics_context.DEPTH_BUFFER_BIT)):alert("could not initialise gl context")}return g_graphics_context}}}(),gl=function(){return graphics_context.get_instance()}();gb.material_cached_parameters=function(){this.m_is_cull_face=!1;this.m_cull_face_mode=-1;this.m_is_blending=!1;this.m_blending_equation=this.m_blending_function_destination=this.m_blending_function_source=-1;this.m_is_stencil_test=!1;this.m_stencil_mask_parameter=this.m_stencil_function_parameter_2=this.m_stencil_function_parameter_1=this.m_stencil_function=-1;this.m_is_depth_mask=this.m_is_depth_test=!1;this.m_shader=null;this.m_textures=[];for(var a=0;8>a;++a)this.m_textures[a]=null;Object.defineProperty(this,
"is_cull_face",{get:function(){return this.m_is_cull_face},set:function(a){this.m_is_cull_face=a}});Object.defineProperty(this,"cull_face_mode",{get:function(){return this.m_cull_face_mode},set:function(a){this.m_cull_face_mode=a}});Object.defineProperty(this,"is_blending",{get:function(){return this.m_is_blending},set:function(a){this.m_is_blending=a}});Object.defineProperty(this,"blending_function_source",{get:function(){return this.m_blending_function_source},set:function(a){this.m_blending_function_source=
a}});Object.defineProperty(this,"blending_function_destination",{get:function(){return this.m_blending_function_destination},set:function(a){this.m_blending_function_destination=a}});Object.defineProperty(this,"blending_equation",{get:function(){return this.m_blending_equation},set:function(a){this.m_blending_equation=a}});Object.defineProperty(this,"is_stencil_test",{get:function(){return this.m_is_stencil_test},set:function(a){this.m_is_stencil_test=a}});Object.defineProperty(this,"stencil_function",
{get:function(){return this.m_stencil_function},set:function(a){this.m_stencil_function=a}});Object.defineProperty(this,"stencil_function_parameter_1",{get:function(){return this.m_stencil_function_parameter_1},set:function(a){this.m_stencil_function_parameter_1=a}});Object.defineProperty(this,"stencil_function_parameter_2",{get:function(){return this.m_stencil_function_parameter_2},set:function(a){this.m_stencil_function_parameter_2=a}});Object.defineProperty(this,"stencil_mask_parameter",{get:function(){return this.m_stencil_mask_parameter},
set:function(a){this.m_stencil_mask_parameter=a}});Object.defineProperty(this,"is_depth_test",{get:function(){return this.m_is_depth_test},set:function(a){this.m_is_depth_test=a}});Object.defineProperty(this,"is_depth_mask",{get:function(){return this.m_is_depth_mask},set:function(a){this.m_is_depth_mask=a}});Object.defineProperty(this,"shader",{get:function(){return this.m_shader},set:function(a){this.m_shader=a}});Object.defineProperty(this,"textures",{get:function(){return this.m_textures},set:function(a){this.m_textures=
a}})};gb.material_cached_parameters.prototype={constructor:gb.material_cached_parameters};
var g_cached_parameters=function(){var a=new gb.material_cached_parameters;a.is_cull_face=!0;gl.enable(gl.CULL_FACE);a.cull_face_mode=gl.BACK;gl.cullFace(gl.BACK);a.is_blending=!0;gl.enable(gl.BLEND);a.blending_function_source=gl.SRC_ALPHA;a.blending_function_destination=gl.ONE_MINUS_SRC_ALPHA;gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);a.is_stencil_test=!1;gl.disable(gl.STENCIL_TEST);a.stencil_function=gl.ALWAYS;a.stencil_function_parameter_1=0;a.stencil_function_parameter_2=0;gl.stencilFunc(gl.ALWAYS,
0,0);a.m_stencil_mask_parameter=0;gl.stencilMask(0);a.is_depth_test=!0;gl.enable(gl.DEPTH_TEST);a.is_depth_mask=!0;gl.depthMask(gl.TRUE);return a}();
gb.material=function(){this.m_parameters=new gb.material_cached_parameters;this.m_custom_shader_uniforms=[];this.m_guid="";Object.defineProperty(this,"is_cull_face",{get:function(){return this.m_parameters.is_cull_face},set:function(a){this.m_parameters.is_culling=a}});Object.defineProperty(this,"cull_face_mode",{get:function(){return this.m_parameters.cull_face_mode},set:function(a){this.m_parameters.cull_face_mode=a}});Object.defineProperty(this,"is_blending",{get:function(){return this.m_parameters.is_blending},
set:function(a){this.m_parameters.is_blending=a}});Object.defineProperty(this,"blending_function_source",{get:function(){return this.m_parameters.blending_function_source},set:function(a){this.m_parameters.blending_function_source=a}});Object.defineProperty(this,"blending_function_destination",{get:function(){return this.m_parameters.blending_function_destination},set:function(a){this.m_parameters.blending_function_destination=a}});Object.defineProperty(this,"blending_equation",{get:function(){return this.m_parameters.blending_equation},
set:function(a){this.m_parameters.blending_equation=a}});Object.defineProperty(this,"is_stencil_test",{get:function(){return this.m_parameters.is_stencil_test},set:function(a){this.m_parameters.is_stencil_test=a}});Object.defineProperty(this,"stencil_function",{get:function(){return this.m_parameters.stencil_function},set:function(a){this.m_parameters.stencil_function=a}});Object.defineProperty(this,"stencil_function_parameter_1",{get:function(){return this.m_parameters.stencil_function_parameter_1},
set:function(a){this.m_parameters.stencil_function_parameter_1=a}});Object.defineProperty(this,"stencil_function_parameter_2",{get:function(){return this.m_parameters.stencil_function_parameter_2},set:function(a){this.m_parameters.stencil_function_parameter_2=a}});Object.defineProperty(this,"stencil_mask_parameter",{get:function(){return this.m_parameters.stencil_mask_parameter},set:function(a){this.m_parameters.stencil_mask_parameter=a}});Object.defineProperty(this,"is_depth_test",{get:function(){return this.m_parameters.is_depth_test},
set:function(a){this.m_parameters.is_depth_test=a}});Object.defineProperty(this,"is_depth_mask",{get:function(){return this.m_parameters.is_depth_mask},set:function(a){this.m_parameters.is_depth_mask=a}});Object.defineProperty(this,"shader",{get:function(){return this.m_shader},set:function(a){this.m_shader=a}});Object.defineProperty(this,"guid",{get:function(){return this.m_guid},set:function(a){this.m_guid=a}})};
gb.material.construct=function(a){var b=new gb.material;b.is_cull_face=a.is_cull_face;b.cull_face_mode=a.cull_face_mode;b.is_blending=a.is_blending;b.blending_function_source=a.blending_function_source;b.blending_function_destination=a.blending_function_destination;b.blending_equation=a.blending_equation;b.is_stencil_test=a.is_stencil_test;b.stencil_function=a.stencil_function;b.stencil_function_parameter_1=a.stencil_function_parameter_1;b.stencil_function_parameter_2=a.stencil_function_parameter_2;
b.stencil_mask_parameter=a.stencil_mask_parameter;b.guid=""+a.technique_name+a.technique_pass+a.shader_configuration.filename;return b};gb.material.set_shader=function(a,b,c){c.get_shader(b.shader_configuration.filename,function(b){a.shader=b})};
gb.material.set_textures=function(a,b,c){for(var d=0;d<b.textures_configurations.length;++d){var e=b.textures_configurations[d];c.get_texture(0!==e.filename.length?e.filename:e.technique_name,function(b){b.wrap_mode=e.wrap_mode;b.mag_filter=e.mag_filter;b.min_filter=e.min_filter;a.set_texture(b,e.sampler_index)})}};gb.material.prototype={constructor:gb.material,set_texture:function(a,b){this.m_parameters.textures[b]=a},bind:function(){},unbind:function(){}};gb.ibo=function(a,b){this.m_handler=gl.createBuffer();this.m_allocated_size=a;this.m_used_size=0;this.m_mode=b;this.m_data=[];for(var c=0;c<this.m_allocated_size;++c)this.m_data[c]=0;Object.defineProperty(this,"allocated_size",{get:function(){return this.m_allocated_size}});Object.defineProperty(this,"used_size",{get:function(){return this.m_used_size}})};
gb.ibo.prototype={constructor:gb.ibo,lock:function(){return this.m_data},unlock:function(){this.m_used_size=0!==arguments.length&&0<arguments[0]&&arguments[0]<this.m_allocated_size?arguments[0]:this.m_allocated_size;gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.m_handler);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.m_data),this.m_mode)},bind:function(){0!==this.m_used_size&&gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.m_handler)},unbind:function(){0!==this.m_used_size&&gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,
null)}};gb.mesh=function(a,b,c){this.m_vbo=a;this.m_ibo=b;this.m_mode=c;Object.defineProperty(this,"vbo",{get:function(){return this.m_vbo}});Object.defineProperty(this,"ibo",{get:function(){return this.m_ibo}})};gb.mesh.prototype={constructor:gb.mesh,bind:function(a){this.m_vbo.bind(a);this.m_ibo.bind()},unbind:function(a){this.m_vbo.unbind(a);this.m_ibo.unbind()},draw:function(){gl.drawElements(gl.TRIANGLES,this.m_ibo.used_size,gl.UNSIGNED_SHORT,0)}};gb.shader_compiler_glsl=function(){this.m_vs_shader_header="precision highp float;\n#if defined(__OPENGL_30__)\nlayout (location = 0) in vec2 a_position;\nlayout (location = 1) in vec2 a_texcoord;\nlayout (location = 4) in vec4 a_color;\n#else\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\nattribute vec4 a_color;\n#endif\n";this.m_fs_shader_header="precision highp float;\n#if defined(__OPENGL_30__)\nlayout (location = 0) out vec4 attachment_01;\n#define gl_FragColor attachment_01\n#define texture2D texture\n#endif\n"};
gb.shader_compiler_glsl.prototype={constructor:gb.shader_compiler_glsl,compile:function(a,b){var c=gl.createShader(b);if(!c)return console.error("can't create shader"),-1;gl.shaderSource(c,b===gl.VERTEX_SHADER?(this.m_vs_shader_header+a).trim():(this.m_fs_shader_header+a).trim());gl.compileShader(c);var d=gl.getShaderInfoLog(c)||"";gl.getShaderParameter(c,gl.COMPILE_STATUS)||console.error(d);return c},link:function(a,b){var c=gl.createProgram();gl.attachShader(c,a);gl.attachShader(c,b);gl.linkProgram(c);
var d=gl.getProgramInfoLog(c)||"";gl.getProgramParameter(c,gl.LINK_STATUS)||(console.error(d),gl.detachShader(c,a),gl.detachShader(c,b),gl.deleteShader(a),gl.deleteShader(b),c=-1);return c}};gb.commiter_status={undefined:0,in_progress:1,failure:2,success:3};gb.resource_commiter=function(a,b){this.m_guid=a;this.m_resource=b;this.m_status=gb.commiter_status.undefined};gb.resource_commiter.prototype={constructor:gb.resource_commiter,clone:function(){return new this.constructor},copy:function(a){this.m_guid=a.m_guid;this.m_resource=a.m_resource;this.m_status=a.m_status;return this},get_guid:function(){return this.m_guid},get_status:function(){return this.m_status}};$.getScript("src/resources/operations/commiters/resource_commiter.js");$.getScript("src/resources/operations/commiters/compilers/shader_compiler_glsl.js");$.getScript("src/resources/transfering_data/shader_transfering_data.js");gb.shader_commiter_glsl=function(a,b){gb.resource_commiter.call(this,a,b)};gb.shader_commiter_glsl.prototype=Object.create(gb.resource_commiter.prototype);gb.shader_commiter_glsl.prototype.constructor=gb.shader_commiter_glsl;
gb.shader_commiter_glsl.prototype.commit=function(a){this.m_status=gb.commiter_status.in_progress;var b=new gb.shader_compiler_glsl,c=gb.commiter_status.failure,d=b.compile(a.vs_source_code,gl.VERTEX_SHADER);if(-1!==d){var e=b.compile(a.fs_source_code,gl.FRAGMENT_SHADER);-1!==e&&(b=b.link(d,e),a.shader_id=b,-1!==b&&(c=gb.commiter_status.success))}this.m_resource.on_transfering_data_commited(a);this.m_status=c};$.getScript("src/resources/operations/commiters/resource_commiter.js");$.getScript("src/resources/transfering_data/texture_transfering_data.js");gb.texture_commiter_png=function(a,b){gb.resource_commiter.call(this,a,b)};gb.texture_commiter_png.prototype=Object.create(gb.resource_commiter.prototype);gb.texture_commiter_png.prototype.constructor=gb.texture_commiter_png;
gb.texture_commiter_png.prototype.commit=function(a){this.m_status=gb.commiter_status.in_progress;var b=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,b);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,a.data);gl.generateMipmap(gl.TEXTURE_2D);a.texture_id=b;this.m_resource.on_transfering_data_commited(a);this.m_status=gb.commiter_status.success};gb.resource_loading_operation_status={undefined:0,in_progress:1,waiting:2,failure:3,success:4};gb.resource_loading_operation=function(a,b){this.m_guid=a;this.m_resource=b;this.m_status=gb.resource_loading_operation_status.undefined;this.m_commiter=this.m_serializer=this.m_transfering_data=null};gb.resource_loading_operation.prototype={constructor:gb.resource_loading_operation,get_guid:function(){return this.m_guid},get_status:function(){return this.m_status}};gb.serializer_status={undefined:0,in_progress:1,failure:2,success:3};gb.resource_serializer=function(a,b){this.m_guid=a;this.m_resource=b;this.m_status=gb.serializer_status.undefined};gb.resource_serializer.prototype={constructor:gb.resource_serializer,clone:function(){return new this.constructor},copy:function(a){this.m_guid=a.m_guid;this.m_resource=a.m_resource;this.m_status=a.m_status;return this},get_guid:function(){return this.m_guid},get_status:function(){return this.m_status}};$.getScript("src/resources/operations/serializers/resource_serializer.js");$.getScript("src/resources/transfering_data/shader_transfering_data.js");gb.shader_serializer_glsl=function(a,b,c){gb.resource_serializer.call(this,a+b,c);this.m_vs_filename=a;this.m_fs_filename=b};gb.shader_serializer_glsl.prototype=Object.create(gb.resource_serializer.prototype);gb.shader_serializer_glsl.prototype.constructor=gb.shader_serializer_glsl;
gb.shader_serializer_glsl.prototype.serialize=function(a,b){this.m_status=gb.serializer_status.in_progress;var c=this;$.ajax({dataType:"text",url:this.m_vs_filename,data:{},async:!0,success:function(d){a.vs_source_code=d;$.ajax({dataType:"text",url:c.m_fs_filename,data:{},async:!0,success:function(d){a.fs_source_code=d;c.m_resource.on_transfering_data_serialized(a);c.m_status=0!==a.vs_source_code.length&&0!==a.fs_source_code.length?gb.serializer_status.success:gb.serializer_status.failure;b()}})}})};$.getScript("src/resources/operations/serializers/resource_serializer.js");$.getScript("src/resources/transfering_data/texture_transfering_data.js");gb.texture_serializer_png=function(a,b){gb.resource_serializer.call(this,a,b);this.m_filename=a};gb.texture_serializer_png.prototype=Object.create(gb.resource_serializer.prototype);gb.texture_serializer_png.prototype.constructor=gb.texture_serializer_png;
gb.texture_serializer_png.prototype.serialize=function(a,b){this.m_status=gb.serializer_status.in_progress;var c=this,d=new Image;d.onload=function(){a.data=d;a.width=d.width;a.height=d.height;c.m_resource.on_transfering_data_serialized(a);c.m_status=gb.serializer_status.success;b()};d.src=this.m_filename};$.getScript("src/resources/transfering_data/shader_transfering_data.js");$.getScript("src/resources/operations/serializers/shader_serializer_glsl.js");$.getScript("src/resources/operations/commiters/shader_commiter_glsl.js");$.getScript("src/resources/operations/resource_loading_operation.js");var k_vs_extension=".vert",k_fs_extension=".frag";gb.shader_loading_operation=function(a,b){gb.resource_loading_operation.call(this,a,b);this.m_transfering_data=new gb.shader_transfering_data};
gb.shader_loading_operation.prototype=Object.create(gb.resource_loading_operation.prototype);gb.shader_loading_operation.prototype.constructor=gb.shader_loading_operation;gb.shader_loading_operation.prototype.start=function(a){var b=this;this.serialize(function(){b.m_status===gb.resource_loading_operation_status.waiting?b.commit(function(){a()}):a()})};
gb.shader_loading_operation.prototype.serialize=function(a){this.m_status=gb.resource_loading_operation_status.in_progress;this.m_serializer=new gb.shader_serializer_glsl(this.m_guid+k_vs_extension,this.m_guid+k_fs_extension,this.m_resource);var b=this;this.m_serializer.serialize(this.m_transfering_data,function(){b.m_status=b.m_serializer.get_status()===gb.serializer_status.success?gb.resource_loading_operation_status.waiting:gb.resource_loading_operation_status.failure;a()})};
gb.shader_loading_operation.prototype.commit=function(a){this.m_status=gb.resource_loading_operation_status.in_progress;this.m_commiter=new gb.shader_commiter_glsl(this.m_guid,this.m_resource);this.m_commiter.commit(this.m_transfering_data);this.m_status=this.m_commiter.get_status()===gb.commiter_status.success?gb.resource_loading_operation_status.success:gb.resource_loading_operation_status.failure;a()};$.getScript("src/resources/transfering_data/texture_transfering_data.js");$.getScript("src/resources/operations/serializers/texture_serializer_png.js");$.getScript("src/resources/operations/commiters/texture_commiter_png.js");$.getScript("src/resources/operations/resource_loading_operation.js");gb.texture_loading_operation=function(a,b){gb.resource_loading_operation.call(this,a,b);this.m_transfering_data=new gb.texture_transfering_data};gb.texture_loading_operation.prototype=Object.create(gb.resource_loading_operation.prototype);
gb.texture_loading_operation.prototype.constructor=gb.texture_loading_operation;gb.texture_loading_operation.prototype.start=function(a){var b=this;this.serialize(function(){b.m_status===gb.resource_loading_operation_status.waiting?b.commit(function(){a()}):a()})};
gb.texture_loading_operation.prototype.serialize=function(a){this.m_status=gb.resource_loading_operation_status.in_progress;this.m_serializer=new gb.texture_serializer_png(this.m_guid,this.m_resource);var b=this;this.m_serializer.serialize(this.m_transfering_data,function(){b.m_status=b.m_serializer.get_status()===gb.serializer_status.success?gb.resource_loading_operation_status.waiting:gb.resource_loading_operation_status.failure;a()})};
gb.texture_loading_operation.prototype.commit=function(a){this.m_status=gb.resource_loading_operation_status.in_progress;this.m_commiter=new gb.texture_commiter_png(this.m_guid,this.m_resource);this.m_commiter.commit(this.m_transfering_data);this.m_status=this.m_commiter.get_status()===gb.commiter_status.success?gb.resource_loading_operation_status.success:gb.resource_loading_operation_status.failure;a()};$.getScript("lib/underscore/underscore-min.js");gb.resource_type={undefined:0,shader:1,texture:2};gb.resource_status={unloaded:0,loaded:1,commited:2};gb.resource_base=function(a){this.m_guid=a;this.m_type=gb.resource_type.undefined;this.m_status=gb.resource_status.unloaded;this.m_listeners=[];this.m_callbacks=[]};
gb.resource_base.prototype={constructor:gb.resource_base,get_guid:function(){return this.m_guid},get_type:function(){return this.m_type},get_status:function(){return this.m_status},on_transfering_data_serialized:function(){},on_transfering_data_commited:function(){},on_resource_loaded:function(a){for(var b=0;b<this.m_listeners.length;++b)this.m_listeners[b].on_resource_loaded(a?this:null);for(b=0;b<this.m_callbacks.length;++b)(0,this.m_callbacks[b])(a?this:null);this.m_listeners=[];this.m_callbacks=
[]},add_resource_loading_listener:function(a){_.isFunction(a.on_resource_loaded)?_.contains(this.m_listeners,a)?console.error("can't add same listener for resource loading"):this.m_listeners.push(a):console.error("resource loading listener doesn't contain on_resource_loaded method")},remove_resource_loading_listener:function(a){a=_.indexOf(this.m_listeners,a);-1!==a?this.m_listeners.splice(a,1):console.error("resource doesn't contain this listener")},add_resource_loading_callback:function(a){_.isFunction(a)?
_.contains(this.m_callbacks,a)?console.error("can't add same callback for resource loading"):this.m_callbacks.push(a):console.error("resource loading callback isn't function")},remove_resource_loading_callback:function(a){a=_.indexOf(this.m_callbacks,a);-1!==a?this.m_callbacks.splice(a,1):console.error("resource doesn't contain this callback")}};$.getScript("src/resources/resource_base.js");gb.uniform_type={mat4:0,mat4_array:1,vec4:2,vec4_array:3,vec3:4,vec3_array:5,vec2:6,vec2_array:7,f32:8,f32_array:9,i32:10,i32_array:11,sampler:12};gb.shader_sampler_type={sampler_01:0,sampler_02:1,sampler_03:2,sampler_04:3,sampler_05:4,sampler_06:5,sampler_07:6,sampler_08:7,max:8};gb.shader_attribute_type={position:0,texcoord:1,color:2,max:3};gb.shader_uniform_type={mat_m:0,mat_p:1,mat_v:2,max:3};
gb.attribute_names={a_position:"a_position",a_texcoord:"a_texcoord",a_color:"a_color"};gb.uniform_names={u_mat_m:"u_mat_m",u_mat_p:"u_mat_p",u_mat_v:"u_mat_v"};gb.sampler_names={sampler_01:"sampler_01",sampler_02:"sampler_02",sampler_03:"sampler_03",sampler_04:"sampler_04",sampler_05:"sampler_05",sampler_06:"sampler_06",sampler_07:"sampler_07",sampler_08:"sampler_08"};gb.shader_uniform=function(a){this.m_type=a};
gb.shader_uniform.prototype={constructor:gb.shader_uniform,set_mat4:function(a){this.m_mat4_value=a},set_mat4_array:function(a){this.m_mat4_array=a;this.m_array_size=a.length},set_vec4:function(a){this.m_vec4_value=a},set_vec4_array:function(a){this.m_vec4_array=a;this.m_array_size=a.length},set_vec3:function(a){this.m_vec3_value=a},set_vec3_array:function(a){this.m_vec3_array=a;this.m_array_size=a.length},set_vec2:function(a){this.m_vec2_value=a},set_vec2_array:function(a){this.m_vec2_array=a;this.m_array_size=
a.length},set_f32:function(a){this.m_f32_value=a},set_f32_array:function(a){this.m_f32_array=a;this.m_array_size=a.length},set_i32:function(a){this.m_i32_value=a},set_i32_array:function(a){this.m_i32_array=a;this.m_array_size=a.length},set_sampler:function(a,b){this.m_texture=a;this.m_sampler_value=b},get_mat4:function(){return this.m_mat4_value},get_mat4_array:function(){return this.m_mat4_array},get_vec4:function(){return this.m_vec4_value},get_vec4_array:function(){return this.m_vec4_array},get_vec3:function(){return this.m_vec3_value},
get_vec3_array:function(){return this.m_vec3_array},get_vec2:function(){return this.m_vec2_value},get_vec2_array:function(){return this.m_vec2_array},get_f32:function(a){return this.m_f32_value},get_f32_array:function(){return this.m_f32_array},get_i32:function(){return this.m_i32_value},get_i32_array:function(){return this.m_i32_array},get_sampler:function(){return this.m_sampler_value},get_texture:function(){return this.m_texture},get_array_size:function(){return this.m_array_size},get_type:function(){return this.m_type}};
gb.shader=function(a){gb.resource_base.call(this,a);this.m_type=gb.resource_type.shader;this.m_shader_id=-1;this.m_uniforms=[];this.m_uniforms[gb.shader_uniform_type.max-1]=-1;this.m_samplers=[];this.m_samplers[gb.shader_sampler_type.max-1]=-1;this.m_attributes=[];this.m_attributes[gb.shader_attribute_type.max-1]=-1;this.m_custom_uniforms=[];this.m_custom_attributes=[];this.m_cached_uniforms=[]};gb.shader.prototype=Object.create(gb.resource_base.prototype);gb.shader.prototype.constructor=gb.shader;
gb.shader.prototype.setup=function(){this.m_uniforms[gb.shader_uniform_type.mat_m]=gl.getUniformLocation(this.m_shader_id,gb.uniform_names.u_mat_m);this.m_uniforms[gb.shader_uniform_type.mat_v]=gl.getUniformLocation(this.m_shader_id,gb.uniform_names.u_mat_v);this.m_uniforms[gb.shader_uniform_type.mat_p]=gl.getUniformLocation(this.m_shader_id,gb.uniform_names.u_mat_p);this.m_uniforms[gb.shader_sampler_type.sampler_01]=gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_01);this.m_uniforms[gb.shader_sampler_type.sampler_02]=
gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_02);this.m_uniforms[gb.shader_sampler_type.sampler_03]=gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_03);this.m_uniforms[gb.shader_sampler_type.sampler_04]=gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_04);this.m_uniforms[gb.shader_sampler_type.sampler_05]=gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_05);this.m_uniforms[gb.shader_sampler_type.sampler_06]=gl.getUniformLocation(this.m_shader_id,
gb.sampler_names.sampler_06);this.m_uniforms[gb.shader_sampler_type.sampler_07]=gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_07);this.m_uniforms[gb.shader_sampler_type.sampler_08]=gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_08);this.m_attributes[gb.shader_attribute_type.position]=gl.getAttribLocation(this.m_shader_id,gb.attribute_names.a_position);this.m_attributes[gb.shader_attribute_type.texcoord]=gl.getAttribLocation(this.m_shader_id,gb.attribute_names.a_texcoord);
this.m_attributes[gb.shader_attribute_type.color]=gl.getAttribLocation(this.m_shader_id,gb.attribute_names.a_color)};gb.shader.prototype.on_transfering_data_serialized=function(a){switch(a.type){case gb.resource_transfering_data_type.shader:this.m_status=gb.resource_status.loaded}};gb.shader.prototype.on_transfering_data_commited=function(a){switch(a.type){case gb.resource_transfering_data_type.shader:this.m_shader_id=a.shader_id,this.m_status=gb.resource_status.commited,this.setup()}};
gb.shader.prototype.get_attributes=function(){return this.m_attributes};gb.shader.prototype.get_custom_uniform=function(a){var b=-1;"undefined"===typeof this.m_custom_uniforms[a]&&(b=gl.getUniformLocation(this.m_shader_id,a),this.m_custom_uniforms[a]=b);return this};
gb.shader.prototype.set_mat4=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.mat4)),gl.uniformMatrix4fv(this.m_uniforms[b],gl.FALSE,new Float32Array(a)),this.m_cached_uniforms[b].set_mat4(a))};
gb.shader.prototype.set_custom_mat4=function(a,b){this.get_status()===gb.resource_status.commited&&gl.uniformMatrix4fv(this.get_custom_uniform(b),gl.FALSE,new Float32Array(a))};
gb.shader.prototype.set_vec4=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.vec4)),gl.uniform4fv(this.m_uniforms[b],gl.FALSE,new Float32Array(a)),this.m_cached_uniforms[b].set_vec4(a))};
gb.shader.prototype.set_custom_vec4=function(a,b){this.get_status()===gb.resource_status.commited&&gl.uniform4fv(this.get_custom_uniform(b),gl.FALSE,new Float32Array(a))};
gb.shader.prototype.set_vec3=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.vec3)),gl.uniform3fv(this.m_uniforms[b],gl.FALSE,new Float32Array(a)),this.m_cached_uniforms[b].set_vec3(a))};
gb.shader.prototype.set_custom_vec3=function(a,b){this.get_status()===gb.resource_status.commited&&gl.uniform3fv(this.get_custom_uniform(b),gl.FALSE,new Float32Array(a))};
gb.shader.prototype.set_vec2=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.vec2)),gl.uniform2fv(this.m_uniforms[b],gl.FALSE,new Float32Array(a)),this.m_cached_uniforms[b].set_vec2(a))};
gb.shader.prototype.set_custom_vec2=function(a,b){this.get_status()===gb.resource_status.commited&&gl.uniform2fv(this.get_custom_uniform(b),gl.FALSE,new Float32Array(a))};
gb.shader.prototype.set_f32=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.f32)),gl.uniform1f(this.m_uniforms[b],gl.FALSE,a),this.m_cached_uniforms[b].set_f32(a))};
gb.shader.prototype.set_custom_f32=function(a,b){this.get_status()===gb.resource_status.commited&&gl.uniform1f(this.get_custom_uniform(b),a)};gb.shader.prototype.set_i32=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.i32)),gl.uniform1i(this.m_uniforms[b],gl.FALSE,a),this.m_cached_uniforms[b].set_i32(a))};
gb.shader.prototype.set_custom_i32=function(a,b){this.get_status()===gb.resource_status.commited&&gl.uniform1i(this.get_custom_uniform(b),a)};gb.shader.prototype.set_texture=function(a,b){this.get_status()===gb.resource_status.commited&&b<gb.shader_sampler_type.max&&(gl.activeTexture(gl.TEXTURE0+b),a.bind(),gl.uniform1i(this.m_samplers[b],b))};gb.shader.prototype.bind=function(){this.get_status()===gb.resource_status.commited&&gl.useProgram(this.m_shader_id)};$.getScript("src/resources/resource_base.js");
gb.texture=function(a){gb.resource_base.call(this,a);this.m_type=gb.resource_type.texture;this.m_texture_id=-1;this.m_setted_wrap_mode=this.m_height=this.m_width=0;this.m_presseted_wrap_mode=gl.REPEAT;this.m_setted_mag_filter=0;this.m_presetted_mag_filter=gl.NEAREST;this.m_setted_min_filter=0;this.m_presetted_min_filter=gl.NEAREST;Object.defineProperty(this,"texture_id",{get:function(){return this.m_texture_id}});Object.defineProperty(this,"width",{get:function(){return this.m_width}});Object.defineProperty(this,
"height",{get:function(){return this.m_height}});Object.defineProperty(this,"wrap_mode",{set:function(a){this.m_presseted_wrap_mode=a}});Object.defineProperty(this,"mag_filter",{set:function(a){this.m_presetted_mag_filter=a}});Object.defineProperty(this,"min_filter",{set:function(a){this.m_presetted_min_filter=a}})};gb.texture.prototype=Object.create(gb.resource_base.prototype);gb.texture.prototype.constructor=gb.texture;
gb.texture.prototype.on_transfering_data_serialized=function(a){switch(a.type){case gb.resource_transfering_data_type.texture:this.m_status=gb.resource_status.loaded}};gb.texture.prototype.on_transfering_data_commited=function(a){switch(a.type){case gb.resource_transfering_data_type.texture:this.m_texture_id=a.texture_id,this.m_width=a.width,this.m_height=a.height,this.m_status=gb.resource_status.commited}};
gb.texture.prototype.bind=function(){this.get_status()===gb.resource_status.commited&&(gl.bindTexture(gl.TEXTURE_2D,this.texture_id),this.m_presseted_wrap_mode!==this.m_setted_wrap_mode&&(this.m_setted_wrap_mode=this.m_presseted_wrap_mode,gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,this.m_setted_wrap_mode),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,this.m_setted_wrap_mode)),this.m_presetted_min_filter!==this.m_setted_min_filter&&(this.m_setted_min_filter=this.m_presetted_min_filter,gl.texParameteri(gl.TEXTURE_2D,
gl.TEXTURE_MIN_FILTER,this.m_setted_min_filter)),this.m_presetted_mag_filter!==this.m_setted_mag_filter&&(this.m_setted_mag_filter=this.m_presetted_mag_filter,gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.m_setted_mag_filter)))};gb.texture.prototype.unbind=function(){gl.bindTexture(gl.TEXTURE_2D,null)};gb.resource_transfering_data_type={undefined:0,shader:1,texture:2};gb.resource_transfering_data=function(){this.m_type=gb.resource_transfering_data_type.undefined;Object.defineProperty(this,"type",{get:function(){return this.m_type}})};gb.resource_transfering_data.prototype={constructor:gb.resource_transfering_data};$.getScript("src/resources/transfering_data/resource_transfering_data.js");
gb.shader_transfering_data=function(){gb.resource_transfering_data.call(this);this.m_type=gb.resource_transfering_data_type.shader;this.m_fs_source_code=this.m_vs_source_code="";this.m_shader_id=-1;Object.defineProperty(this,"vs_source_code",{get:function(){return this.m_vs_source_code},set:function(a){this.m_vs_source_code=a}});Object.defineProperty(this,"fs_source_code",{get:function(){return this.m_fs_source_code},set:function(a){this.m_fs_source_code=a}});Object.defineProperty(this,"shader_id",
{get:function(){return this.m_shader_id},set:function(a){this.m_shader_id=a}})};gb.shader_transfering_data.prototype=Object.create(gb.resource_transfering_data.prototype);gb.shader_transfering_data.prototype.constructor=gb.shader_transfering_data;$.getScript("src/resources/transfering_data/resource_transfering_data.js");
gb.texture_transfering_data=function(){gb.resource_transfering_data.call(this);this.m_type=gb.resource_transfering_data_type.texture;this.m_height=this.m_width=0;this.m_data=null;this.m_texture_id=-1;Object.defineProperty(this,"width",{get:function(){return this.m_width},set:function(a){this.m_width=a}});Object.defineProperty(this,"height",{get:function(){return this.m_height},set:function(a){this.m_height=a}});Object.defineProperty(this,"texture_id",{get:function(){return this.m_texture_id},set:function(a){this.m_texture_id=
a}});Object.defineProperty(this,"data",{get:function(){return this.m_data},set:function(a){this.m_data=a}})};gb.texture_transfering_data.prototype=Object.create(gb.resource_transfering_data.prototype);gb.texture_transfering_data.prototype.constructor=gb.texture_transfering_data;gb.vertex_attribute=function(){this.m_position=new gb.vec2(0);this.m_texcoord=new gb.vec2(0);this.m_color=new gb.vec4(0);Object.defineProperty(this,"position",{get:function(){return this.m_position},set:function(a){this.m_position=a}});Object.defineProperty(this,"texcoord",{get:function(){return this.m_texcoord},set:function(a){this.m_texcoord=a}});Object.defineProperty(this,"color",{get:function(){return this.m_color},set:function(a){this.m_color=a}})};
gb.vertex_attribute.prototype={constructor:gb.vertex_attribute,to_array:function(){return[this.m_position.x,this.m_position.y,this.m_texcoord.x,this.m_texcoord.y,this.m_color.x,this.m_color.y,this.m_color.z,this.m_color.w]}};
gb.vbo=function(a,b){this.m_handler=gl.createBuffer();this.m_allocated_size=a;this.m_used_size=0;this.m_mode=b;this.m_min_bound=new gb.vec2(INT16_MAX);this.m_max_bound=new gb.vec2(INT16_MIN);this.m_data=[];for(var c=0;c<this.m_allocated_size;++c)this.m_data[c]=new gb.vertex_attribute;Object.defineProperty(this,"allocated_size",{get:function(){return this.m_allocated_size}});Object.defineProperty(this,"used_size",{get:function(){return this.m_used_size}});Object.defineProperty(this,"min_bound",{get:function(){return this.m_min_bound}});
Object.defineProperty(this,"max_bound",{get:function(){return this.m_max_bound}})};
gb.vbo.prototype={constructor:gb.vbo,lock:function(){return this.m_data},unlock:function(){this.m_used_size=0!==arguments.length&&0<arguments[0]&&arguments[0]<this.m_allocated_size?arguments[0]:this.m_allocated_size;gl.bindBuffer(gl.ARRAY_BUFFER,this.m_handler);for(var a=[],b=0;b<this.m_used_size;++b){for(var c=this.m_data[b].to_array(),d=0;d<c.length;++d)a.push(c[d]);c=new gb.vec2(c[0],c[1]);this.m_min_bound=gb.vec2.min(c,this.m_min_bound);this.m_max_bound=gb.vec2.max(c,this.m_max_bound)}gl.bufferData(gl.ARRAY_BUFFER,
new Float32Array(a),this.m_mode)},bind:function(a){0!==this.m_used_size&&(gl.bindBuffer(gl.ARRAY_BUFFER,this.m_handler),0<=a[gb.shader_attribute_type.position]&&(gl.vertexAttribPointer(a[gb.shader_attribute_type.position],2,gl.FLOAT,!1,32,0),gl.enableVertexAttribArray(a[gb.shader_attribute_type.position])),0<=a[gb.shader_attribute_type.texcoord]&&(gl.vertexAttribPointer(a[gb.shader_attribute_type.texcoord],2,gl.FLOAT,!1,32,8),gl.enableVertexAttribArray(a[gb.shader_attribute_type.texcoord])),0<=a[gb.shader_attribute_type.color]&&
(gl.vertexAttribPointer(a[gb.shader_attribute_type.color],4,gl.FLOAT,!1,32,16),gl.enableVertexAttribArray(a[gb.shader_attribute_type.color])))},unbind:function(a){0!==this.m_used_size&&(gl.bindBuffer(gl.ARRAY_BUFFER,this.m_handler),0<=a[gb.shader_attribute_type.position]&&gl.disableVertexAttribArray(a[gb.shader_attribute_type.position]),0<=a[gb.shader_attribute_type.texcoord]&&gl.disableVertexAttribArray(a[gb.shader_attribute_type.texcoord]),0<=a[gb.shader_attribute_type.color]&&gl.disableVertexAttribArray(a[gb.shader_attribute_type.color]),
gl.bindBuffer(gl.ARRAY_BUFFER,null))}};function output(){var a=arguments,b=1;console.log(a[0].replace(/%((%)|s|d)/g,function(c){var d=null;if(c[2])d=c[2];else{d=a[b];switch(c){case "%d":d=parseFloat(d),isNaN(d)&&(d=0)}b++}return d}))};
