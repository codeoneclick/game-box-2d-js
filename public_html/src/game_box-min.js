var gb={REVISION:"1"};"function"===typeof define&&define.amd?define("gb",gb):"undefined"!==typeof exports&&"undefined"!==typeof module&&(module.exports=gb);function ces_base_component(){this.m_type="undefined"}ces_base_component.prototype.get_type=function(){return this.m_type};gb.configuration_base=function(){this.m_attributes=[];this.m_configurations=[]};
gb.configuration_base.prototype={constructor:gb.configuration_base,clone:function(){return new this.constructor},copy:function(a){this.m_attributes=a.m_attributes;this.m_configurations=a.m_configurations;return this},set_attribute:function(a,b){this.m_attributes[a]=b;return this},set_configuration:function(a,b,c){this.m_configurations[a]instanceof Object?3===arguments.length?0<=c&&c<this.m_configurations[a].length?this.m_configurations[a][c]=b:this.m_configurations[a].push(b):this.m_configurations[a].push(b):
(this.m_configurations[a]=[],this.m_configurations[a].push(b));return this}};$.getScript("src/configurations/configuration_base.js");gb.game_object_configuration=function(){gb.configuration_base.call(this)};gb.game_object_configuration.prototype=Object.create(gb.configuration_base.prototype);gb.game_object_configuration.prototype.constructor=gb.game_object_configuration;
gb.game_object_configuration.prototype.get_materials_configurations=function(){return this.m_configurations instanceof Object&&this.m_configurations.materials instanceof Object?this.m_configurations.materials:null};$.getScript("src/configurations/configuration_base.js");$.getScript("src/configurations/shader_configuration.js");$.getScript("src/configurations/texture_configuration.js");gb.material_configuration=function(){gb.configuration_base.call(this);this.json=null};gb.material_configuration.prototype=Object.create(gb.configuration_base.prototype);gb.material_configuration.prototype.constructor=gb.material_configuration;
gb.material_configuration.prototype.serialize=function(a){var b=this;$.ajax({dataType:"json",url:a,data:{},async:!1,success:function(a){b.json=a;a=new gb.shader_configuration;a.serialize(b.json.shader);b.set_configuration("shader",a);for(var d=0;d<b.json.textures.length;++d)a=new gb.texture_configuration,a.serialize(b.json.textures[d]),b.set_configuration("textures",a)}})};gb.material_configuration.prototype.get_technique_name=function(){return this.json.technique_name};
gb.material_configuration.prototype.get_technique_pass=function(){return this.json.technique_pass};gb.material_configuration.prototype.get_depth_test=function(){return this.json.is_depth_test};gb.material_configuration.prototype.get_depth_mask=function(){return this.json.is_depth_mask};gb.material_configuration.prototype.get_cull_face=function(){return this.json.is_cull_face};gb.material_configuration.prototype.get_cull_face_mode=function(){return this.json.cull_face_mode};
gb.material_configuration.prototype.get_blending=function(){return this.json.is_blending};gb.material_configuration.prototype.get_blending_function_source=function(){return this.json.blending_function_source};gb.material_configuration.prototype.get_blending_function_destination=function(){return this.json.blending_function_destination};gb.material_configuration.prototype.get_blending_equation=function(){return this.json.blending_equation};gb.material_configuration.prototype.get_stencil_test=function(){return this.json.is_stencil_test};
gb.material_configuration.prototype.get_stencil_function=function(){return this.json.is_stencil_function};gb.material_configuration.prototype.get_stencil_function_parameter_1=function(){return this.json.stencil_function_parameter_1};gb.material_configuration.prototype.get_stencil_function_parameter_2=function(){return this.json.stencil_function_parameter_2};gb.material_configuration.prototype.get_stencil_mask_parameter=function(){return this.json.stencil_mask_parameter};
gb.material_configuration.prototype.get_debugging=function(){return this.json.is_debugging};gb.material_configuration.prototype.get_shader_configuration=function(){return this.m_configurations instanceof Object&&this.m_configurations.shader instanceof Object&&0<this.m_configurations.shader.length?this.m_configurations.shader[0]:null};
gb.material_configuration.prototype.get_textures_configurations=function(){return this.m_configurations instanceof Object&&this.m_configurations.textures instanceof Object?this.m_configurations.textures:null};$.getScript("src/configurations/configuration_base.js");gb.shader_configuration=function(){gb.configuration_base.call(this);this.json=null};gb.shader_configuration.prototype=Object.create(gb.configuration_base.prototype);gb.shader_configuration.prototype.constructor=gb.shader_configuration;gb.shader_configuration.prototype.serialize=function(a){this.json=a};gb.shader_configuration.prototype.get_filename=function(){return this.json.filename};$.getScript("src/configurations/configuration_base.js");gb.texture_configuration=function(){gb.configuration_base.call(this);this.json=null};gb.texture_configuration.prototype=Object.create(gb.configuration_base.prototype);gb.texture_configuration.prototype.constructor=gb.texture_configuration;gb.texture_configuration.prototype.serialize=function(a){this.json=a};gb.texture_configuration.prototype.get_filename=function(){return this.json.filename};
gb.texture_configuration.prototype.get_render_technique_name=function(){return this.json.render_technique_name};gb.texture_configuration.prototype.get_sampler_index=function(){return this.json.sampler_index};gb.texture_configuration.prototype.get_wrap_mode=function(){return this.json.wrap_mode};gb.texture_configuration.prototype.get_mag_filter=function(){return this.json.mag_filter};gb.texture_configuration.prototype.get_min_filter=function(){return this.json.min_filter};var game_loop=function(a){function b(){d.attach_to_runloop()(b)}function c(){d={attach_to_runloop:function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1E3/60)}}};return{instance:d,attach_to_runloop:d.attach_to_runloop}}var d=null;return{get_instance:function(){d||(d=c().instance,b());return d}}}(window);gb.mat4=function(){this.m_elements=[[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]]};
gb.mat4.multiply=function(a,b){var c=a.m_elements,d=b.m_elements,e=new gb.mat4,f=c[0],g=c[4],h=c[8],k=c[12],l=c[1],m=c[5],n=c[9],p=c[13],q=c[2],r=c[6],t=c[10],u=c[14],v=c[3],w=c[7],x=c[11],c=c[15],y=d[0],z=d[4],A=d[8],B=d[12],C=d[1],D=d[5],E=d[9],F=d[13],G=d[2],H=d[6],I=d[10],J=d[14],K=d[3],L=d[7],M=d[11],d=d[15];e.m_elements[0]=f*y+g*C+h*G+k*K;e.m_elements[4]=f*z+g*D+h*H+k*L;e.m_elements[8]=f*A+g*E+h*I+k*M;e.m_elements[12]=f*B+g*F+h*J+k*d;e.m_elements[1]=l*y+m*C+n*G+p*K;e.m_elements[5]=l*z+m*D+n*
H+p*L;e.m_elements[9]=l*A+m*E+n*I+p*M;e.m_elements[13]=l*B+m*F+n*J+p*d;e.m_elements[2]=q*y+r*C+t*G+u*K;e.m_elements[6]=q*z+r*D+t*H+u*L;e.m_elements[10]=q*A+r*E+t*I+u*M;e.m_elements[14]=q*B+r*F+t*J+u*d;e.m_elements[3]=v*y+w*C+x*G+c*K;e.m_elements[7]=v*z+w*D+x*H+c*L;e.m_elements[11]=v*A+w*E+x*I+c*M;e.m_elements[15]=v*B+w*F+x*J+c*d;return e};
gb.mat4.prototype={constructor:gb.mat4,identity:function(){this.m_elements[0]=1;this.m_elements[4]=0;this.m_elements[8]=0;this.m_elements[12]=0;this.m_elements[1]=0;this.m_elements[5]=1;this.m_elements[9]=0;this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=1;this.m_elements[14]=0;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},rotate:function(a){var b=a.x,c=a.y,d=a.z;a=Math.cos(b);var b=Math.sin(b),e=Math.cos(c),
c=Math.sin(c),f=Math.cos(d),d=Math.sin(d),g=a*f,h=a*d,k=b*f,l=b*d;this.m_elements[0]=e*f;this.m_elements[4]=-e*d;this.m_elements[8]=c;this.m_elements[1]=h+k*c;this.m_elements[5]=g-l*c;this.m_elements[9]=-b*e;this.m_elements[2]=l-g*c;this.m_elements[6]=k+h*c;this.m_elements[10]=a*e;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[12]=0;this.m_elements[13]=0;this.m_elements[14]=0;this.m_elements[15]=1;return this},translate:function(a,b,c){this.m_elements[0]=1;this.m_elements[4]=
0;this.m_elements[8]=0;this.m_elements[12]=0;this.m_elements[1]=0;this.m_elements[5]=1;this.m_elements[9]=0;this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=1;this.m_elements[14]=0;this.m_elements[3]=a;this.m_elements[7]=b;this.m_elements[11]=c;this.m_elements[15]=1;return this},rotation_x:function(a){var b=Math.cos(a);a=Math.sin(a);this.m_elements[0]=1;this.m_elements[4]=0;this.m_elements[8]=0;this.m_elements[12]=0;this.m_elements[1]=0;this.m_elements[5]=b;this.m_elements[9]=
-a;this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=a;this.m_elements[10]=b;this.m_elements[14]=0;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},rotate_y:function(a){var b=Math.cos(a);a=Math.sin(a);this.m_elements[0]=b;this.m_elements[4]=0;this.m_elements[8]=a;this.m_elements[12]=0;this.m_elements[1]=0;this.m_elements[5]=1;this.m_elements[9]=0;this.m_elements[13]=0;this.m_elements[2]=-a;this.m_elements[6]=0;this.m_elements[10]=b;this.m_elements[14]=
0;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},rotate_z:function(a){var b=Math.cos(a);a=Math.sin(a);this.m_elements[0]=b;this.m_elements[4]=-a;this.m_elements[8]=0;this.m_elements[12]=0;this.m_elements[1]=a;this.m_elements[5]=b;this.m_elements[9]=0;this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=1;this.m_elements[14]=0;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},
scale:function(a,b,c){this.m_elements[0]=a;this.m_elements[4]=0;this.m_elements[8]=0;this.m_elements[12]=0;this.m_elements[1]=0;this.m_elements[5]=b;this.m_elements[9]=0;this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=c;this.m_elements[14]=0;this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},frustum:function(a,b,c,d,e,f){this.m_elements[0]=2*e/(b-a);this.m_elements[4]=0;this.m_elements[8]=(b+a)/(b-a);this.m_elements[12]=
0;this.m_elements[1]=0;this.m_elements[5]=2*e/(d-c);this.m_elements[9]=(d+c)/(d-c);this.m_elements[13]=0;this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=-(f+e)/(f-e);this.m_elements[14]=-2*f*e/(f-e);this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=-1;this.m_elements[15]=0;return this},perspective:function(a,b,c,d){a=c*Math.tan(gb.math.radians(.5*a));var e=-a;return this.frustum(e*b,a*b,e,a,c,d)},ortho:function(a,b,c,d,e,f){var g=1/(b-a),h=1/(c-d),k=1/(f-e);this.m_elements[0]=
2*g;this.m_elements[4]=0;this.m_elements[8]=0;this.m_elements[12]=-((b+a)*g);this.m_elements[1]=0;this.m_elements[5]=2*h;this.m_elements[9]=0;this.m_elements[13]=-((c+d)*h);this.m_elements[2]=0;this.m_elements[6]=0;this.m_elements[10]=-2*k;this.m_elements[14]=-((f+e)*k);this.m_elements[3]=0;this.m_elements[7]=0;this.m_elements[11]=0;this.m_elements[15]=1;return this},look_at:function(a,b,c){var d=new gb.vec3,e=new gb.vec3,f=new gb.vec3,f=gb.vec3.sub(a,b).normalize();0===f.length_sq()&&(f.z=1);d=gb.vec3.cross(c,
f).normalize();0===d.length_sq()&&(f.x+=1E-4,d=gb.vec3.cross(c,f).normalize());e=gb.vec3.cross(f,d);this.m_elements[0]=d.x;this.m_elements[4]=e.x;this.m_elements[8]=f.x;this.m_elements[1]=d.y;this.m_elements[5]=e.y;this.m_elements[9]=f.y;this.m_elements[2]=d.z;this.m_elements[6]=e.z;this.m_elements[10]=f.z;return this},equals:function(a){for(var b=0;16>b;b++)if(this.m_elements[b]!==a.m_elements[b])return!1;return!0},to_array:function(){return this.m_elements}};gb.math=function(){};gb.math.radians=function(a){return Math.PI/180*a};gb.math.degrees=function(a){return 180/Math.PI*a};gb.vec2=function(){arguments[0]instanceof gb.vec2?(this.m_x=arguments[0].x,this.m_y=arguments[0].y):1===arguments.length?(this.m_x=arguments[0],this.m_y=arguments[0]):2===arguments.length?(this.m_x=arguments[0],this.m_y=arguments[1]):this.m_y=this.m_x=0;Object.defineProperty(this,"x",{get:function(){return this.m_x},set:function(a){this.m_x=a}});Object.defineProperty(this,"y",{get:function(){return this.m_y},set:function(a){this.m_y=a}})};gb.vec2.add=function(a,b){return new gb.vec2(a.x+b.x,a.y+b.y)};
gb.vec2.sub=function(a,b){return new gb.vec2(a.x-b.x,a.y-b.y)};gb.vec2.lerp=function(a,b,c){return gb.vec2.sub(b,a).multiply_scalar(c).add(a)};gb.vec2.equals=function(a,b){return a.x===b.x&&a.y===b.y};
gb.vec2.prototype={constructor:gb.vec2,add:function(a){this.x+=a.x;this.y+=a.y;return this},add_scalar:function(a){this.x+=a;this.y+=a;return this},sub:function(a){this.x-=a.x;this.y-=a.y;return this},sub_scalar:function(a){this.x-=a;this.y-=a;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiply_scalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divide_scalar:function(a){this.x/=a;this.y/=a;return this},min:function(a){this.x=
Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},dot:function(a){return this.x*a.x+this.y*a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divide_scalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);
return a},distance_to:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},equals:function(a){return a.x===this.x&&a.y===this.y},to_array:function(){var a=[];a[0]=this.x;a[1]=this.y;return a}};gb.vec3=function(){"gb.vec3"===typeof arguments[0]?(this.m_x=arguments[0].x,this.m_y=arguments[0].y,this.m_z=arguments[0].z):1===arguments.length?(this.m_x=arguments[0],this.m_y=arguments[0],this.m_z=arguments[0]):3===arguments.length?(this.m_x=arguments[0],this.m_y=arguments[1],this.m_z=arguments[2]):this.m_z=this.m_y=this.m_x=0;Object.defineProperty(this,"x",{get:function(){return this.m_x},set:function(a){this.m_x=a}});Object.defineProperty(this,"y",{get:function(){return this.m_y},set:function(a){this.m_y=
a}});Object.defineProperty(this,"z",{get:function(){return this.m_z},set:function(a){this.m_z=a}})};gb.vec3.add=function(a,b){return new gb.vec3(a.x+b.x,a.y+b.y,a.z+b.z)};gb.vec3.sub=function(a,b){return new gb.vec3(a.x-b.x,a.y-b.y,a.z-b.z)};gb.vec3.cross=function(a,b){return new gb.vec3(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x)};
gb.vec3.prototype={constructor:gb.vec3,add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},add_scalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},sub_scalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiply_scalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},
divide_scalar:function(a){this.x/=a;this.y/=a;this.z/=a;return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*
a.z},cross:function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},length_sq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divide_scalar(this.length())},distance_to:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return Math.sqrt(b*b+c*c+a*a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=
(a.z-this.z)*b;return this},lerp_vectors:function(a,b,c){this.sub_vectors(b,a).multiply_scalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},to_array:function(){var a=[];a[0]=this.x;a[1]=this.y;a[2]=this.z;return a}};gb.vec4=function(){"gb.vec4"===typeof arguments[0]?(this.x=arguments[0].get_x(),this.y=arguments[0].get_y(),this.z=arguments[0].get_z(),this.w=arguments[0].get_w()):1===arguments.length?(this.x=arguments[0],this.y=arguments[0],this.z=arguments[0],this.w=arguments[0]):4===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2],this.w=arguments[3]):this.w=this.z=this.y=this.x=0};
gb.vec4.prototype={constructor:gb.vec4,clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},set_x:function(a){this.x=a;return this},set_y:function(a){this.y=a;return this},set_z:function(a){this.z=a;return this},set_w:function(a){this.w=a;return this},get_x:function(){return this.x},get_y:function(){return this.y},get_z:function(){return this.z},get_w:function(){return this.w},add:function(a){this.x+=a.x;
this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},add_scalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},add_vectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},sub_scalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},sub_vectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiply:function(a){this.x*=
a.x;this.y*=a.y;this.z*=a.z;this.w*=a.w;return this},multiply_scalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;this.w/=a.w;return this},divide_scalar:function(a){this.x/=a;this.y/=a;this.z/=a;this.w/=a;return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,
a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){return this.divide_scalar(this.length())},lerp:function(a,
b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerp_vectors:function(a,b,c){this.sub_vectors(b,a).multiply_scalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},to_array:function(){var a=[];a[0]=this.x;a[1]=this.y;a[2]=this.z;a[3]=this.w;return a}};gb.gl=null;var graphics_context=function(){var a=null;return{get_instance:function(){if(!a){var b=document.getElementById("gl_canvas");try{a=b.getContext("experimental-webgl"),a.viewportWidth=b.width,a.viewportHeight=b.height}catch(c){}a?(a.clearColor(0,0,0,1),a.enable(a.DEPTH_TEST),a.viewport(0,0,a.viewportWidth,a.viewportHeight),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)):alert("could not initialise gl context");gb.gl=a}return a}}}();gb.shader_compiler_glsl=function(){this.m_vs_shader_header="precision highp float;#if defined(__OPENGL_30__)layout (location = 0) in vec2 a_position;layout (location = 1) in vec2 a_texcoord;layout (location = 4) in vec4 a_color;#elseattribute vec2 a_position;attribute vec2 a_texcoord;attribute vec4 a_color;#endif";this.m_fs_shader_header="precision highp float;#if defined(__OPENGL_30__)layout (location = 0) out vec4 attachment_01;#define gl_FragColor attachment_01#define texture2D texture#endif"};
gb.shader_compiler_glsl.prototype={constructor:gb.shader_compiler_glsl,compile:function(a,b){var c=gb.gl.createShader(b);if(!c)return console.error("can't create shader"),-1;gb.gl.shaderSource(c,b===gb.gl.VERTEX_SHADER?(this.m_vs_shader_header+a).trim():(this.m_fs_shader_header+a).trim());gb.gl.compileShader(c);var d=gb.gl.getShaderInfoLog(c)||"";gb.gl.getShaderParameter(c,gb.gl.COMPILE_STATUS)||console.error(d);return c},link:function(a,b){var c=gb.gl.createProgram();gb.gl.attachShader(c,a);gb.gl.attachShader(c,
b);gb.gl.linkProgram(c);var d=gb.gl.getProgramInfoLog(c)||"";gb.gl.getProgramParameter(c,gb.gl.LINK_STATUS)||(console.error(d),gb.gl.detachShader(c,a),gb.gl.detachShader(c,b),gb.gl.deleteShader(a),gb.gl.deleteShader(b),c=-1);return c}};gb.commiter_status={undefined:0,in_progress:1,failure:2,success:3};gb.resource_commiter=function(a,b){this.m_guid=a;this.m_resource=b;this.m_status=gb.commiter_status.undefined};gb.resource_commiter.prototype={constructor:gb.resource_commiter,clone:function(){return new this.constructor},copy:function(a){this.m_guid=a.m_guid;this.m_resource=a.m_resource;this.m_status=a.m_status;return this},get_guid:function(){return this.m_guid},get_status:function(){return this.m_status}};$.getScript("src/resources/operations/commiters/resource_commiter.js");$.getScript("src/resources/operations/commiters/compilers/shader_compiler_glsl.js");$.getScript("src/resources/transfering_data/shader_transfering_data.js");$.getScript("src/render/graphics_context.js");gb.shader_commiter_glsl=function(a,b){gb.resource_commiter.call(this,a,b)};gb.shader_commiter_glsl.prototype=Object.create(gb.resource_commiter.prototype);gb.shader_commiter_glsl.prototype.constructor=gb.shader_commiter_glsl;
gb.shader_commiter_glsl.prototype.commit=function(a){this.m_status=gb.commiter_status.in_progress;var b=new gb.shader_compiler_glsl,c=gb.commiter_status.failure,d=b.compile(a.get_vs_source_code(),graphics_context.get_instance().VERTEX_SHADER);if(-1!==d){var e=b.compile(a.get_fs_source_code(),graphics_context.get_instance().FRAGMENT_SHADER);-1!==e&&(b=b.link(d,e),a.set_shader_id(b),-1!==b&&(c=gb.commiter_status.success))}this.m_resource.on_transfering_data_commited(a);this.m_status=c};gb.resource_loading_operation_status={undefined:0,in_progress:1,waiting:2,failure:3,success:4};gb.resource_loading_operation=function(a,b){this.m_guid=a;this.m_resource=b;this.m_status=gb.resource_loading_operation_status.undefined;this.m_commiter=this.m_serializer=this.m_transfering_data=null};gb.resource_loading_operation.prototype={constructor:gb.resource_loading_operation,get_guid:function(){return this.m_guid},get_status:function(){return this.m_status}};gb.serializer_status={undefined:0,in_progress:1,failure:2,success:3};gb.resource_serializer=function(a,b){this.m_guid=a;this.m_resource=b;this.m_status=gb.serializer_status.undefined};gb.resource_serializer.prototype={constructor:gb.resource_serializer,clone:function(){return new this.constructor},copy:function(a){this.m_guid=a.m_guid;this.m_resource=a.m_resource;this.m_status=a.m_status;return this},get_guid:function(){return this.m_guid},get_status:function(){return this.m_status}};$.getScript("src/resources/operations/serializers/resource_serializer.js");$.getScript("src/resources/transfering_data/shader_transfering_data.js");gb.shader_serializer_glsl=function(a,b,c){gb.resource_serializer.call(this,a+b,c);this.m_vs_filename=a;this.m_fs_filename=b};gb.shader_serializer_glsl.prototype=Object.create(gb.resource_serializer.prototype);gb.shader_serializer_glsl.prototype.constructor=gb.shader_serializer_glsl;
gb.shader_serializer_glsl.prototype.serialize=function(a){this.m_status=gb.serializer_status.in_progress;$.ajax({dataType:"text",url:this.m_vs_filename,data:{},async:!1,success:function(b){a.set_vs_source_code(b)}});$.ajax({dataType:"text",url:this.m_fs_filename,data:{},async:!1,success:function(b){a.set_fs_source_code(b)}});this.m_resource.on_transfering_data_serialized(a);this.m_status=0!==a.get_vs_source_code().length&&0!==a.get_fs_source_code().length?gb.serializer_status.success:gb.serializer_status.failure};$.getScript("src/resources/transfering_data/shader_transfering_data.js");$.getScript("src/resources/operations/serializers/shader_serializer_glsl.js");$.getScript("src/resources/operations/commiters/shader_commiter_glsl.js");$.getScript("src/resources/operations/resource_loading_operation.js");var k_vs_extension=".vert",k_fs_extension=".frag";gb.shader_loading_operation=function(a,b){gb.resource_loading_operation.call(this,a,b);this.m_transfering_data=new gb.shader_transfering_data};
gb.shader_loading_operation.prototype=Object.create(gb.resource_loading_operation.prototype);gb.shader_loading_operation.prototype.constructor=gb.shader_loading_operation;
gb.shader_loading_operation.prototype.serialize=function(){this.m_status=gb.resource_loading_operation_status.in_progress;this.m_serializer=new gb.shader_serializer_glsl(this.m_guid+k_vs_extension,this.m_guid+k_fs_extension,this.m_resource);this.m_serializer.serialize(this.m_transfering_data);this.m_status=this.m_serializer.get_status()===gb.serializer_status.success?gb.resource_loading_operation_status.waiting:gb.resource_loading_operation_status.failure};
gb.shader_loading_operation.prototype.commit=function(){this.m_status=gb.resource_loading_operation_status.in_progress;this.m_commiter=new gb.shader_commiter_glsl(this.m_guid,this.m_resource);this.m_commiter.commit(this.m_transfering_data);this.m_status=this.m_commiter.get_status()===gb.commiter_status.success?gb.resource_loading_operation_status.success:gb.resource_loading_operation_status.failure};$.getScript("lib/underscore/underscore-min.js");gb.resource_type={undefined:0,shader:1,texture:2};gb.resource_status={unloaded:0,loaded:1,commited:2};gb.resource_base=function(a){this.m_guid=a;this.m_type=gb.resource_type.undefined;this.m_status=gb.resource_status.unloaded;this.m_listeners=[];this.m_callbacks=[]};
gb.resource_base.prototype={constructor:gb.resource_base,get_guid:function(){return this.m_guid},get_type:function(){return this.m_type},get_status:function(){return this.m_status},on_transfering_data_serialized:function(){},on_transfering_data_commited:function(){},on_resource_loaded:function(a){for(var b=0;b<this.m_listeners.length;++b)this.m_listeners[b].on_resource_loaded(a?this:null);for(b=0;b<this.m_callbacks.length;++b)(0,this.m_callbacks[b])(a?this:null);this.m_listeners=[];this.m_callbacks=
[]},add_resource_loading_listener:function(a){_.isFunction(a.on_resource_loaded)?_.contains(this.m_listeners,a)?console.error("can't add same listener for resource loading"):this.m_listeners.push(a):console.error("resource loading listener doesn't contain on_resource_loaded method")},remove_resource_loading_listener:function(a){a=_.indexOf(this.m_listeners,a);-1!==a?this.m_listeners.splice(a,1):console.error("resource doesn't contain this listener")},add_resource_loading_callback:function(a){_.isFunction(a)?
_.contains(this.m_callbacks,a)?console.error("can't add same callback for resource loading"):this.m_callbacks.push(a):console.error("resource loading callback isn't function")},remove_resource_loading_callback:function(a){a=_.indexOf(this.m_callbacks,a);-1!==a?this.m_callbacks.splice(a,1):console.error("resource doesn't contain this callback")}};$.getScript("src/resources/resource_base.js");gb.uniform_type={mat4:0,mat4_array:1,vec4:2,vec4_array:3,vec3:4,vec3_array:5,vec2:6,vec2_array:7,f32:8,f32_array:9,i32:10,i32_array:11,sampler:12};gb.shader_sampler_type={sampler_01:0,sampler_02:1,sampler_03:2,sampler_04:3,sampler_05:4,sampler_06:5,sampler_07:6,sampler_08:7,max:8};gb.shader_attribute_type={position:0,texcoord:1,color:2,max:3};gb.shader_uniform_type={mat_m:0,mat_p:1,mat_v:2,max:3};
gb.attribute_names={a_position:"a_position",a_texcoord:"a_texcoord",a_color:"a_color"};gb.uniform_names={u_mat_m:"u_mat_m",u_mat_p:"u_mat_p",u_mat_v:"u_mat_v"};gb.sampler_names={sampler_01:"sampler_01",sampler_02:"sampler_02",sampler_03:"sampler_03",sampler_04:"sampler_04",sampler_05:"sampler_05",sampler_06:"sampler_06",sampler_07:"sampler_07",sampler_08:"sampler_08"};gb.shader_uniform=function(a){this.m_type=a};
gb.shader_uniform.prototype={constructor:gb.shader_uniform,set_mat4:function(a){this.m_mat4_value=a},set_mat4_array:function(a){this.m_mat4_array=a;this.m_array_size=a.length},set_vec4:function(a){this.m_vec4_value=a},set_vec4_array:function(a){this.m_vec4_array=a;this.m_array_size=a.length},set_vec3:function(a){this.m_vec3_value=a},set_vec3_array:function(a){this.m_vec3_array=a;this.m_array_size=a.length},set_vec2:function(a){this.m_vec2_value=a},set_vec2_array:function(a){this.m_vec2_array=a;this.m_array_size=
a.length},set_f32:function(a){this.m_f32_value=a},set_f32_array:function(a){this.m_f32_array=a;this.m_array_size=a.length},set_i32:function(a){this.m_i32_value=a},set_i32_array:function(a){this.m_i32_array=a;this.m_array_size=a.length},set_sampler:function(a,b){this.m_texture=a;this.m_sampler_value=b},get_mat4:function(){return this.m_mat4_value},get_mat4_array:function(){return this.m_mat4_array},get_vec4:function(){return this.m_vec4_value},get_vec4_array:function(){return this.m_vec4_array},get_vec3:function(){return this.m_vec3_value},
get_vec3_array:function(){return this.m_vec3_array},get_vec2:function(){return this.m_vec2_value},get_vec2_array:function(){return this.m_vec2_array},get_f32:function(a){return this.m_f32_value},get_f32_array:function(){return this.m_f32_array},get_i32:function(){return this.m_i32_value},get_i32_array:function(){return this.m_i32_array},get_sampler:function(){return this.m_sampler_value},get_texture:function(){return this.m_texture},get_array_size:function(){return this.m_array_size},get_type:function(){return this.m_type}};
gb.shader=function(a){gb.resource_base.call(this,a);this.m_type=gb.resource_type.shader;this.m_shader_id=-1;this.m_uniforms=[];this.m_uniforms[gb.shader_uniform_type.max-1]=-1;this.m_samplers=[];this.m_samplers[gb.shader_sampler_type.max-1]=-1;this.m_attributes=[];this.m_attributes[gb.shader_attribute_type.max-1]=-1;this.m_custom_uniforms=[];this.m_custom_attributes=[];this.m_cached_uniforms=[]};gb.shader.prototype=Object.create(gb.resource_base.prototype);gb.shader.prototype.constructor=gb.shader;
gb.shader.prototype.setup=function(){this.m_uniforms[gb.shader_uniform_type.mat_m]=gb.gl.getUniformLocation(this.m_shader_id,gb.uniform_names.u_mat_m);this.m_uniforms[gb.shader_uniform_type.mat_v]=gb.gl.getUniformLocation(this.m_shader_id,gb.uniform_names.u_mat_v);this.m_uniforms[gb.shader_uniform_type.mat_p]=gb.gl.getUniformLocation(this.m_shader_id,gb.uniform_names.u_mat_p);this.m_uniforms[gb.shader_sampler_type.sampler_01]=gb.gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_01);
this.m_uniforms[gb.shader_sampler_type.sampler_02]=gb.gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_02);this.m_uniforms[gb.shader_sampler_type.sampler_03]=gb.gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_03);this.m_uniforms[gb.shader_sampler_type.sampler_04]=gb.gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_04);this.m_uniforms[gb.shader_sampler_type.sampler_05]=gb.gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_05);this.m_uniforms[gb.shader_sampler_type.sampler_06]=
gb.gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_06);this.m_uniforms[gb.shader_sampler_type.sampler_07]=gb.gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_07);this.m_uniforms[gb.shader_sampler_type.sampler_08]=gb.gl.getUniformLocation(this.m_shader_id,gb.sampler_names.sampler_08);this.m_attributes[gb.shader_attribute_type.position]=gb.gl.getAttribLocation(this.m_shader_id,gb.attribute_names.a_position);this.m_attributes[gb.shader_attribute_type.texcoord]=gb.gl.getAttribLocation(this.m_shader_id,
gb.attribute_names.a_texcoord);this.m_attributes[gb.shader_attribute_type.color]=gb.gl.getAttribLocation(this.m_shader_id,gb.attribute_names.a_color)};gb.shader.prototype.on_transfering_data_serialized=function(a){switch(a.get_type()){case gb.resource_transfering_data_type.shader:this.m_status=gb.resource_status.loaded}};
gb.shader.prototype.on_transfering_data_commited=function(a){switch(a.get_type()){case gb.resource_transfering_data_type.shader:this.m_shader_id=a.get_shader_id(),this.m_status=gb.resource_status.commited,this.setup()}};gb.shader.prototype.get_attributes=function(){return this.m_attributes};gb.shader.prototype.get_custom_uniform=function(a){var b=-1;"undefined"===typeof this.m_custom_uniforms[a]&&(b=gb.gl.getUniformLocation(this.m_shader_id,a),this.m_custom_uniforms[a]=b);return this};
gb.shader.prototype.set_mat4=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.mat4)),gb.gl.uniformMatrix4fv(this.m_uniforms[b],gb.gl.FALSE,new Float32Array(a)),this.m_cached_uniforms[b].set_mat4(a))};
gb.shader.prototype.set_custom_mat4=function(a,b){this.get_status()===gb.resource_status.commited&&gb.gl.uniformMatrix4fv(this.get_custom_uniform(b),gb.gl.FALS,new Float32Array(a))};
gb.shader.prototype.set_vec4=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.vec4)),gb.gl.uniform4fv(this.m_uniforms[b],gb.gl.FALSE,new Float32Array(a)),this.m_cached_uniforms[b].set_vec4(a))};
gb.shader.prototype.set_custom_vec4=function(a,b){this.get_status()===gb.resource_status.commited&&gb.gl.uniform4fv(this.get_custom_uniform(b),gb.gl.FALSE,new Float32Array(a))};
gb.shader.prototype.set_vec3=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.vec3)),gb.gl.uniform3fv(this.m_uniforms[b],gb.gl.FALSE,new Float32Array(a)),this.m_cached_uniforms[b].set_vec3(a))};
gb.shader.prototype.set_custom_vec3=function(a,b){this.get_status()===gb.resource_status.commited&&gb.gl.uniform3fv(this.get_custom_uniform(b),gb.gl.FALSE,new Float32Array(a))};
gb.shader.prototype.set_vec2=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.vec2)),gb.gl.uniform2fv(this.m_uniforms[b],gb.gl.FALSE,new Float32Array(a)),this.m_cached_uniforms[b].set_vec2(a))};
gb.shader.prototype.set_custom_vec2=function(a,b){this.get_status()===gb.resource_status.commited&&gb.gl.uniform2fv(this.get_custom_uniform(b),gb.gl.FALSE,new Float32Array(a))};
gb.shader.prototype.set_f32=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.f32)),gb.gl.uniform1f(this.m_uniforms[b],gb.gl.FALSE,a),this.m_cached_uniforms[b].set_f32(a))};
gb.shader.prototype.set_custom_f32=function(a,b){this.get_status()===gb.resource_status.commited&&gb.gl.uniform1f(this.get_custom_uniform(b),a)};gb.shader.prototype.set_i32=function(a,b){this.get_status()!==gb.resource_status.commited||"undefined"!==typeof this.m_cached_uniforms[b]&&this.m_cached_uniforms[b]===a||("undefined"===typeof this.m_cached_uniforms[b]&&(this.m_cached_uniforms[b]=gb.shader_uniform(gb.uniform_type.i32)),gb.gl.uniform1i(this.m_uniforms[b],gb.gl.FALSE,a),this.m_cached_uniforms[b].set_i32(a))};
gb.shader.prototype.set_custom_i32=function(a,b){this.get_status()===gb.resource_status.commited&&gb.gl.uniform1i(this.get_custom_uniform(b),a)};gb.shader.prototype.set_texture=function(a,b){this.get_status()===gb.resource_status.commited&&b<gb.shader_sampler_type.max&&(gb.gl.activeTexture(gb.gl.TEXTURE0+b),a.bind(),gb.gl.uniform1i(this.m_samplers[b],b))};gb.shader.prototype.bind=function(){this.get_status()===gb.resource_status.commited&&gb.gl.useProgram(this.m_shader_id)};gb.resource_transfering_data_type={undefined:0,shader:1,texture:2};gb.resource_transfering_data=function(){this.m_type=gb.resource_transfering_data_type.undefined};gb.resource_transfering_data.prototype={constructor:gb.resource_transfering_data,get_type:function(){return this.m_type}};$.getScript("src/resources/transfering_data/resource_transfering_data.js");gb.shader_transfering_data=function(){gb.resource_transfering_data.call(this);this.m_type=gb.resource_transfering_data_type.shader;this.m_fs_source_code=this.m_vs_source_code="";this.m_shader_id=-1};gb.shader_transfering_data.prototype=Object.create(gb.resource_transfering_data.prototype);gb.shader_transfering_data.prototype.constructor=gb.shader_transfering_data;
gb.shader_transfering_data.prototype.set_vs_source_code=function(a){this.m_vs_source_code=a};gb.shader_transfering_data.prototype.get_vs_source_code=function(){return this.m_vs_source_code};gb.shader_transfering_data.prototype.set_fs_source_code=function(a){this.m_fs_source_code=a};gb.shader_transfering_data.prototype.get_fs_source_code=function(){return this.m_fs_source_code};gb.shader_transfering_data.prototype.set_shader_id=function(a){this.m_shader_id=a};
gb.shader_transfering_data.prototype.get_shader_id=function(){return this.m_shader_id};function output(){var a=arguments,b=1;console.log(a[0].replace(/%((%)|s|d)/g,function(c){var d=null;if(c[2])d=c[2];else{d=a[b];switch(c){case "%d":d=parseFloat(d),isNaN(d)&&(d=0)}b++}return d}))};
